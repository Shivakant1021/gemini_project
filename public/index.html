<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gemini AI Chat</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gemini AI Chat</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
 <!-- Sidebar -->
  <div id="sidebar">
    <div class="sidebar-header">
      <h2>Search History</h2>
      <button id="closeSidebar">✖</button>
    </div>
    <ul id="historyList"></ul>
  </div>

  <!-- Sidebar toggle button (for mobile only) -->
  <button id="toggleSidebar" class="hamburger">☰</button>

  <div class="header">
    <img
      src="https://akm-img-a-in.tosshub.com/indiatoday/images/story/202505/gemini-303403593-3x4.png?VersionId=GX9GSEa1YB4mOgGbrZJdi36lrfB2PPFY"
      alt="Gemini Logo" width="100" />
    <h1>💬 Gemini AI Chat Bot</h1>
    <span id="date">Date :</span>
  </div>
  <div>
    <div class="center-body">
      <div id="chat-box"></div>

      <div id="input-area">
        <textarea id="prompt" placeholder="Type your question..."></textarea>
        <button onclick="askGemini()">Send</button>
        <button onclick="clearChat()">🆕 New Chat</button>
      </div>

      <div class="footer">
        <p>
          Developed by <a href="https://github.com/shivakant1021" target="_blank">Shviakant Singh</a> | 📩
          shivakant011999@gmail.com |
          <a href="https://www.linkedin.com/in/shivakant-singh-a53523250/" target="_blank">Git Hub</a>
        </p>
      </div>
    </div>


  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
 const dateElem = document.getElementById("date");
    const today = new Date().toLocaleDateString();
    dateElem.textContent = `Date : ${today}`;

    const chatBox = document.getElementById("chat-box");
    const historyList = document.getElementById("historyList");
    const promptInput = document.getElementById("prompt");

    // Append chat message
    function appendMessage(content, type) {
      const div = document.createElement("div");
      div.className = `message ${type}`;
      div.innerText = content;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Add search to history
    function addToHistory(query) {
      const li = document.createElement("li");
      li.textContent = query;
      li.addEventListener("click", () => {
        promptInput.value = query;
        askGemini();
      });
      historyList.prepend(li); // newest on top
    }

    // Ask Gemini (API)
    async function askGemini() {
      const prompt = promptInput.value.trim();
      if (!prompt) return;

      promptInput.value = "";
      appendMessage(prompt, "user");
      addToHistory(prompt);

      const loader = document.createElement("div");
      loader.className = "message loader bot";
      loader.innerText = "Gemini is typing...";
      chatBox.appendChild(loader);
      chatBox.scrollTop = chatBox.scrollHeight;

      try {
        const res = await fetch("/api/gemini", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt })
        });

        const data = await res.json();
        loader.remove();
        appendMessage(data.response, "bot");
      } catch (err) {
        loader.remove();
        appendMessage("❌ Error: Could not reach Gemini", "bot");
        console.error(err);
      }
    }

    // Submit on Ctrl+Enter
    promptInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) {
        askGemini();
      }
    });

    // Clear chat with SweetAlert
    function clearChat() {
      Swal.fire({
        title: 'Start New Chat?',
        text: "This will clear the current conversation.",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, clear it!'
      }).then((result) => {
        if (result.isConfirmed) {
          chatBox.innerHTML = "";
          promptInput.value = "";
          Swal.fire('Cleared!', 'Your chat has been cleared.', 'success');
        }
      });
    }

    // Sidebar toggle
    const sidebar = document.getElementById("sidebar");
const toggleBtn = document.getElementById("toggleSidebar");
const closeBtn = document.getElementById("closeSidebar");

toggleBtn.addEventListener("click", () => {
  sidebar.classList.add("active"); // open sidebar
  toggleBtn.style.display = "none"; // hide toggle button
  closeBtn.style.display = "block"; // show close button
});

closeBtn.addEventListener("click", () => {
  sidebar.classList.remove("active"); // close sidebar
  toggleBtn.style.display = "block"; // show toggle button
  closeBtn.style.display = "none"; // hide close button
});

// Desktop behavior
function handleResize() {
  if (window.innerWidth > 768) {
    sidebar.classList.add("active");     // always open on desktop
    toggleBtn.style.display = "none";    // hide hamburger
    closeBtn.style.display = "none";     // hide close button
  } else {
    sidebar.classList.remove("active");  // closed by default on mobile
    toggleBtn.style.display = "block";   // show hamburger
    closeBtn.style.display = "none";     // hide close button initially
  }
}

// Run on load + on resize
handleResize();
window.addEventListener("resize", handleResize);
  </script>
</body>

</html>