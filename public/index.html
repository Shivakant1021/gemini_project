<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ai — Neon Chat</title>
  <link rel="icon" type="image/png" href="./assets/ai-character.png" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />

  <style>
    /* --- Neon theme helpers --- */
    :root {
      --bg: #0b0f14;
      --panel: #071018;
      --muted: #8a9ba8;
      --neon-blue: #00a8ff;
      --neon-purple: #8a2be2;
    }

    html,
    body,
    #app {
      height: 100%;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(10, 18, 26, 0.45), transparent 10%),
        radial-gradient(900px 500px at 90% 90%, rgba(40, 10, 60, 0.25), transparent 10%),
        var(--bg);
      color: #dbeafe;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ---------------------------
       ⭐ FULL MOBILE SIDEBAR FIX
       --------------------------- */
    #sidebar {
      width: 264px;
      transform: translateX(0);
      transition: transform 0.35s ease-in-out;
      z-index: 40;
    }

    /* Hidden by default on mobile */
    @media (max-width: 768px) {
      #sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        transform: translateX(-100%);
      }

      #sidebar.open {
        transform: translateX(0);
      }
    }

    /* Overlay */
    #overlay {
      backdrop-filter: blur(5px);
      background: rgba(0, 0, 0, 0.55);
      transition: opacity .3s ease;
    }

    /* SweetAlert fixes */
    .swal2-container {
      z-index: 99999 !important;
    }

    .swal2-popup {
      border-radius: 12px !important;
    }

    .swal2-shown.sweet-alert-fix {
      height: 100vh;
      overflow: hidden;
      display: block;
    }

    /* Neon bubble glow */
    .neon-blue {
      box-shadow: 0 8px 30px rgba(0, 168, 255, 0.08), 0 0 18px rgba(0, 168, 255, 0.12);
      border: 1px solid rgba(0, 168, 255, 0.12);
    }

    .neon-purple {
      box-shadow: 0 8px 30px rgba(138, 43, 226, 0.08), 0 0 16px rgba(138, 43, 226, 0.12);
      border: 1px solid rgba(138, 43, 226, 0.12);
    }

    .msg-full {
      width: 95%;
      max-width: 95%;
    }

    .glow-accent {
      background-image: linear-gradient(135deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      border-radius: 12px;
      border-left: 1px solid rgba(255, 255, 255, 0.02);
      backdrop-filter: blur(6px);
    }

    .dots>span {
      display: inline-block;
      width: 6px;
      height: 6px;
      margin: 0 3px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.35);
      opacity: 0.7;
      animation: dot 1s infinite ease-in-out;
    }

    .dots>span:nth-child(2) {
      animation-delay: 0.15s
    }

    .dots>span:nth-child(3) {
      animation-delay: 0.3s
    }

    @keyframes dot {

      0%,
      80%,
      100% {
        transform: translateY(0);
        opacity: .4
      }

      40% {
        transform: translateY(-6px);
        opacity: 1
      }
    }

    .fade-in {
      animation: fadein 360ms ease both;
    }

    @keyframes fadein {
      from {
        opacity: 0;
        transform: translateY(6px)
      }

      to {
        opacity: 1;
        transform: none
      }
    }
  </style>
</head>

<body class="h-screen flex">

  <div id="app" class="flex-1 flex overflow-hidden">

    <!-- ==========================
         ⭐ SIDEBAR
         ========================== -->
    <aside id="sidebar"
      class="bg-gradient-to-b from-black/60 to-slate-900/60 border-r border-slate-800/60 text-slate-200 p-4 flex flex-col">

      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
          <div
            class="w-10 h-10 rounded-xl bg-gradient-to-tr flex items-center justify-center shadow-lg">
            <img src="./assets/ai-character.png" alt="g" class="w-8 h-8 rounded" />
          </div>
          <div>
            <h3 class="text-lg font-semibold text-cyan-300">History</h3>
            <p class="text-xs text-slate-400">Recent prompts</p>
          </div>
        </div>

        <button id="closeSidebar" class="md:hidden text-slate-300 text-xl">✖</button>
      </div>

      <ul id="historyList" class="flex-1 overflow-y-auto space-y-2 pr-2"></ul>

      <!-- SOCIAL LINKS SECTION -->
      <div class="mt-6 text-xs text-slate-400 space-y-3">

        <div>Tip: <span class="text-slate-200">Ctrl/Cmd + Enter</span> to send</div>

        <div class="pt-3 border-t border-slate-800/40">
          <p class="text-[10px] mb-2 text-slate-500 uppercase tracking-wide">Connect with me</p>

          <div class="flex flex-col gap-2">

            <a href="https://github.com/shivakant1021" target="_blank"
              class="flex items-center gap-3 px-3 py-2 rounded-lg bg-slate-900/40 hover:bg-slate-900/70 border border-slate-800/40 neon-blue transition-all">
              <i class="fab fa-github text-xl text-cyan-300"></i>
              <span class="text-slate-200 text-sm font-medium">GitHub</span>
            </a>

            <a href="https://www.linkedin.com/in/shivakant-singh-a53523250/" target="_blank"
              class="flex items-center gap-3 px-3 py-2 rounded-lg bg-slate-900/40 hover:bg-slate-900/70 border border-slate-800/40 neon-purple transition-all">
              <i class="fab fa-linkedin text-xl text-purple-300"></i>
              <span class="text-slate-200 text-sm font-medium">LinkedIn</span>
            </a>

            <a href="https://shivakant1021.github.io/portfolio/"
              target="_blank"
              class="flex items-center gap-3 px-3 py-2 rounded-lg bg-slate-900/40 hover:bg-slate-900/70 border border-slate-800/40"
              style="box-shadow:0 0 12px rgba(0,168,255,0.15);border:1px solid rgba(80,200,255,0.30);">
              <i class="fa fa-user text-xl text-pink-400"></i>
              <span class="text-slate-200 text-sm font-medium">Portfolio</span>
            </a>

          </div>
        </div>

        <p class="text-center text-[11px] text-slate-500 mt-3">
          © <span id="year"></span> <span class="text-cyan-300 font-semibold">Shivakant</span>. All Rights Reserved.
        </p>

      </div>

    </aside>

    <!-- ==========================
         ⭐ OVERLAY (Mobile)
         ========================== -->
    <div id="overlay" class="hidden fixed inset-0 z-30 opacity-0 pointer-events-none"></div>

    <!-- ==========================
         ⭐ MAIN CONTENT
         ========================== -->
    <div class="flex-1 flex flex-col">

      <!-- HEADER -->
      <header class="flex items-center justify-between p-4 border-b border-slate-800/60 glow-accent">
        <div class="flex items-center gap-4">

          <button id="toggleSidebar"
            class="md:hidden p-2 rounded-md bg-slate-800/40 text-slate-300 hover:bg-slate-800/60">
            <i class="fa fa-bars"></i>
          </button>

          <div class="flex items-center gap-3">
            <img src="./assets/ai-neon.png" class="w-12 h-12 rounded-lg shadow-lg" />
            <div>
              <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-cyan-300 to-blue-400">
                AI — Neon Chat
              </h1>
              <p class="text-xs text-slate-400">Secure Neon • Futuristic</p>
            </div>
          </div>

        </div>

        <div id="date" class="text-sm text-slate-400">Date</div>

      </header>

      <!-- FIXED BLURRED BACKGROUND (now works while scrolling) -->
      <div class="absolute inset-0 z-0 pointer-events-none overflow-hidden">
        <img src="./assets/ai-character.png" class="w-full h-full object-cover blur-sm opacity-40" />
      </div>

      <!-- CHAT AREA -->
      <main id="chatArea" class="relative z-10 flex-1 overflow-auto p-6">

        <div id="chat-box" class="relative w-full max-w-[1600px] mx-auto space-y-4">

          <!-- Welcome card -->
          <div class="mx-auto msg-full rounded-xl p-6 neon-purple glow-accent border border-purple-800/10">
            <div class="flex items-start gap-4">

              <div class="w-12 h-12 rounded-md flex items-center justify-center">
                <img src="./assets/ai-character.png" class="w-12 h-12 rounded-full shadow-lg" />
              </div>

              <div>
                <h3 class="text-lg font-semibold text-purple-300">
                  Next-Gen Conversational Intelligence
                </h3>
                <p class="text-slate-300/80 mt-1">
                  Welcome — ask anything!
                </p>
              </div>

            </div>
          </div>

        </div>
      </main>


      <!-- INPUT BOX -->
      <div class="p-4 border-t border-slate-800/60 glow-accent">
        <div class="max-w-[1600px] mx-auto grid grid-cols-12 gap-3 items-center">

          <textarea id="prompt" rows="1"
            class="col-span-10 resize-none p-4 rounded-lg bg-slate-900/80 border border-slate-800 text-slate-200 outline-none focus:ring-2 focus:ring-cyan-400 transition-all"
            placeholder="Type your message..."></textarea>

          <div class="col-span-2 flex flex-col gap-2">
            <button id="sendBtn"
              class="w-full py-3 rounded-lg bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 shadow-lg text-white font-semibold">
              Send
            </button>

            <button id="newBtn"
              class="w-full py-3 rounded-lg bg-gradient-to-r from-red-600 to-red-500 hover:from-red-700 text-white font-semibold">
              New Chat
            </button>
          </div>

        </div>
      </div>

    </div>
  </div>

  <!-- SweetAlert -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    /* -------------------------------
       Sidebar Logic (FULLY FIXED)
       ------------------------------- */

    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const toggleSidebar = document.getElementById("toggleSidebar");
    const closeSidebar = document.getElementById("closeSidebar");

    function openSidebar() {
      sidebar.classList.add("open");
      overlay.classList.remove("hidden");
      overlay.style.opacity = "1";
      overlay.style.pointerEvents = "auto";
    }

    function hideSidebar() {
      sidebar.classList.remove("open");
      overlay.style.opacity = "0";
      overlay.style.pointerEvents = "none";
      setTimeout(() => overlay.classList.add("hidden"), 250);
    }

    toggleSidebar.addEventListener("click", openSidebar);
    closeSidebar.addEventListener("click", hideSidebar);
    overlay.addEventListener("click", hideSidebar);

    /* DATE UPDATE */
    document.getElementById("date").textContent = `Date : ${new Date().toLocaleDateString()}`;

    /* --------------------------------
       Chat logic
       -------------------------------- */

    const chatBox = document.getElementById("chat-box");
    const prompt = document.getElementById("prompt");
    const sendBtn = document.getElementById("sendBtn");
    const newBtn = document.getElementById("newBtn");
    const historyList = document.getElementById("historyList");

    function scrollBottom() {
      document.getElementById('chatArea').scrollTop =
        document.getElementById('chatArea').scrollHeight;
    }

    function escapeHtml(unsafe) {
      return String(unsafe)
        .replace(/&/g, "&amp;").replace(/</g, "&lt;")
        .replace(/>/g, "&gt;").replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    /* ---------------------------
       NEW: FULL MARKDOWN PARSER
       --------------------------- */
    function renderMarkdown(text) {
      let html = escapeHtml(text);

      // Headings
      html = html.replace(/^### (.*$)/gim, "<h3 class='text-lg font-bold'>$1</h3>");
      html = html.replace(/^## (.*$)/gim, "<h2 class='text-xl font-bold'>$1</h2>");
      html = html.replace(/^# (.*$)/gim, "<h1 class='text-2xl font-bold'>$1</h1>");

      // Bold + italic
      html = html.replace(/\*\*\*(.*?)\*\*\*/gim, "<strong><em>$1</em></strong>");
      html = html.replace(/\*\*(.*?)\*\*/gim, "<strong>$1</strong>");
      html = html.replace(/\*(.*?)\*/gim, "<em>$1</em>");

      // Code blocks
      html = html.replace(/```([\s\S]*?)```/gim, "<pre class='bg-slate-900 p-3 rounded-lg overflow-x-auto'><code>$1</code></pre>");

      // Inline code
      html = html.replace(/`([^`]+)`/gim, "<code class='bg-slate-800 px-1 rounded'>$1</code>");

      // Bullet points
      html = html.replace(/^\s*[-•]\s+(.*)$/gim, "<li>$1</li>");

      // Numbered lists
      html = html.replace(/^\s*\d+\.\s+(.*)$/gim, "<li>$1</li>");

      // Wrap lists
      if (html.includes("<li>")) {
        html = `<ul class='list-disc ml-6 space-y-1'>${html}</ul>`;
      }

      // Blockquote
      html = html.replace(/^> (.*)$/gim, "<blockquote class='border-l-4 border-slate-500 pl-3 italic text-slate-300'>$1</blockquote>");

      // Line breaks
      html = html.replace(/\n/g, "<br>");

      return html;
    }

    /* ---------------------------
        CREATE MESSAGE BUBBLE
       --------------------------- */
    function createMessage(text, who, isHtml = false) {
      const wrap = document.createElement("div");
      wrap.className = "msg-full fade-in mx-auto p-4 rounded-xl flex gap-4 items-start";

      if (who === "user") {
        wrap.classList.add("justify-end");
        wrap.innerHTML = `
      <div class="max-w-full msg-full neon-blue p-4 rounded-xl text-slate-900 font-medium"
        style="background: linear-gradient(90deg,#00a8ffb8,#00a8ff22);">
        ${escapeHtml(text)}
      </div>`;
      } else {
        wrap.classList.add("justify-start");
        wrap.innerHTML = `
      <div class="max-w-full msg-full neon-purple p-4 rounded-xl text-slate-100"
        style="background: linear-gradient(90deg,#6a2bdc33,#8a2be233);">
        ${isHtml ? text : escapeHtml(text)}
      </div>`;
      }
      return wrap;
    }

    function addToHistory(q) {
      const li = document.createElement("li");
      li.className = "text-slate-300 px-2 py-1 rounded hover:bg-slate-800/40 cursor-pointer text-sm";
      li.textContent = q;
      li.onclick = () => { prompt.value = q; sendMessage(); };
      historyList.prepend(li);
    }

    function loaderEl() {
      const d = document.createElement("div");
      d.className = "msg-full fade-in neon-purple p-3 rounded-xl";
      d.innerHTML = `<div class="flex items-center gap-3">
    <div class="dots"><span></span><span></span><span></span></div>
    <div class="text-slate-300 ml-2 italic">AI is thinking...</div>
  </div>`;
      return d;
    }

    /* ---------------------------
       SEND MESSAGE (Markdown Mode)
       --------------------------- */
    async function sendMessage() {
      const q = prompt.value.trim();
      if (!q) return;

      // USER message
      const userMsg = createMessage(q, "user");
      chatBox.appendChild(userMsg);
      addToHistory(q);
      prompt.value = "";
      scrollBottom();

      // Loader
      const loader = loaderEl();
      chatBox.appendChild(loader);
      scrollBottom();

      try {
        const resp = await fetch('/api/gemini', {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt: q })
        });

        const data = resp.ok ? await resp.json() : { response: "Server error" };
        loader.remove();

        const raw = data.response || "";
        const html = renderMarkdown(raw);

        const botMsg = createMessage(html, "bot", true);
        chatBox.appendChild(botMsg);

      } catch (err) {
        loader.remove();
        chatBox.appendChild(createMessage("❌ Error: Could not reach Gemini", "bot"));
      }

      scrollBottom();
    }

    sendBtn.onclick = sendMessage;

    prompt.addEventListener("keydown", e => {
      if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) {
        e.preventDefault(); sendMessage();
      }
    });

  /* NEW CHAT */
newBtn.onclick = () => {
  Swal.fire({
    title: "Start New Chat?",
    text: "This will clear the current conversation.",
    icon: "warning",
    showCancelButton: true,
    confirmButtonColor: "#3085d6",
    cancelButtonColor: "#d33",
    confirmButtonText: "Yes, clear it!"
  }).then(r => {
    if (r.isConfirmed) {
      chatBox.innerHTML = "";

      const welcome = document.createElement("div");
      welcome.className =
        "mx-auto msg-full rounded-xl p-6 neon-purple glow-accent border border-purple-800/10";

      welcome.innerHTML = `
        <div class="flex items-start gap-4">
          <div class="w-12 h-12 rounded-md bg-gradient-to-tr flex items-center justify-center">
            <img src="./assets/ai-neon.png" class="w-8 h-8 rounded" />
          </div>

          <div>
            <h3 class="text-lg font-semibold text-purple-300">
              Next-Gen Conversational Intelligence
            </h3>
            <p class="text-slate-300/80 mt-1">Welcome — ask anything!</p>
          </div>
        </div>
      `;

      chatBox.appendChild(welcome);
    }
  });
};


    /* Auto expand textarea */
    prompt.addEventListener("input", () => {
      prompt.style.height = "auto";
      prompt.style.height = prompt.scrollHeight + "px";
    });


  </script>
</body>

</html>